---
title: 网站优化-静态化
date: 2017-7-3 9:00:02
tags:
	- 静态化
	- ab测试
categories: 网站优化
---

### ab测试工具  
* -n 请求的总数量
* -c 并发数
* -t 请求的总时间 单位秒

```
//在并发数100的情况下，发出5000个请求，所消耗的时间  
ding:github-blog echo-ding$ ab -n 5000 -c 100 http://www.yiifirst.com/
//在并发100的情况下，持续10秒，可以完成多少请求数
//ding:github-blog echo-ding$ ab -t 10 -c 100 http://www.yiifirst.com/

----------------输出-------------------
//软件信息
This is ApacheBench, Version 2.3 <$Revision: 1796539 $>
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/
//测试进度
Benchmarking www.yiifirst.com (be patient)
Completed 500 requests
Completed 1000 requests
Completed 1500 requests
Completed 2000 requests
Completed 2500 requests
Completed 3000 requests
Completed 3500 requests
Completed 4000 requests
Completed 4500 requests
Completed 5000 requests
Finished 5000 requests

//服务器信息
Server Software:        Apache/2.4.26
Server Hostname:        www.yiifirst.com
Server Port:            80
//响应信息
Document Path:          /
Document Length:        25938 bytes
//测试结果
Concurrency Level:      100     #并发级别
Time taken for tests:   61.459 seconds #测试总用时
Complete requests:      5000    #完成请求数量
Failed requests:        0       #请求失败数
Total transferred:      132882558 bytes  #总的数据传输量
HTML transferred:       129690000 bytes  #总的数据量，响应主体
Requests per second:    81.36 [#/sec] (mean)    #请求数量／每秒
Time per request:       1229.171 [ms] (mean)    #每组请求消耗的时间
Time per request:       12.292 [ms] (mean, across all concurrent requests) #平均每个请求消耗的时间
Transfer rate:          2111.47 [Kbytes/sec] received #传输效率

//结果的统计
//最佳，最差，平均结果
Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    2   7.7      0     120
Processing:    77 1223 264.1   1219    2608
Waiting:       47 1146 235.2   1166    1998
Total:         78 1225 264.0   1221    2608

//统计结果
Percentage of the requests served within a certain time (ms)
  50%   1221
  66%   1310
  75%   1372
  80%   1413
  90%   1539
  95%   1658
  98%   1793    //98%的请求可以在 1793ms内完成
  99%   1909
 100%   2608 (longest request)
```

## 静态化
> 页面静态化，就是将需要后段数据配合生成的页面缓存起来，下次访问将不再需要对后段的各种请求解析，直接访问存取的静态页面  
> 框架正常都带有方便的缓存设置功能方法，不需要手动写ob了

### ob缓存
**简单操作**
```php
ob_start()开启输出缓冲  
	之后的任意的响应主体输出，都会存储到该缓冲区。  
ob_get_content() 获取缓冲中内容  
	所有的响应主体都输出完毕后，需要获取到。  
Ob_get_clean();// 获取后清空;之前的输出将不会在客户端输出
Ob_get_flush();// 获取后刷新；之前的输出立刻输出到客户端
ob_end_clean(); 关闭同时清空输出缓冲；将不会输入
    file_put_contents($filename, $content); //将获取到的内容输出到文件

开启 start
Ob_start()

获取 get
Ob_get_contents();// 获取内容
Ob_get_clean();// 获取后清空
Ob_get_flush();// 获取后刷新


刷新 flush
将缓冲内容向下传输
Ob_flush();// 直接刷新
	在需要将内容立即在浏览器端显示时，通常使用！
Ob_end_flush(); 刷新后关闭
Ob_get_flush(); 获取后刷新
即使没有刷新，脚本结束时，PHP核心会自动刷新。

清空 clean
清空缓存区内容
Ob_clean(); 直接清空
Ob_get_clean(); 获取后清空
Ob_end_clean(); 清空关闭

关闭 end
Ob_end_clean(); 清空后关闭
Ob_end_flush(); 刷新后关闭。
后续的输出就不会再出现在输出缓存中。

```

**多ob**
ob缓冲区，允许开启多次    
每当执行一次OB_start()就会开启一次输出缓存。  
而对OB的操作，都是针对于当前的活跃缓存区。--最新开启的这个缓存区。  

```php
Ob_get_level()获取当前缓存的深度。
```
PHP默认会开启一个输出缓冲。
```php
php.ini
output_buffering = 4096          开启缓冲，并设置最大缓冲大小 4096byte
```

**缓冲处理器**
开启缓冲时，可以制定一个函数，用于处理当缓冲内容被刷新时，处理缓存数据。  

典型的处理器：  
`ob_gzhandler(); `
根据浏览器所能够接受的压缩类型，对缓冲数据进行压缩。  

使用缓存压缩  --开启的时候加入处理器名字即可
```php
ob_start( 'ob_gzhandler');
```

### 程序缓存
PHP默认的缓冲区。一直在，几乎不能操作。  
一个函数对该缓存进行操作：   
```php
flush(); 		#刷新程序缓存

Ob_flush();	 #输出ob缓冲
```
如果需要将数据立即在浏览器端显示时。使用 `ob_flush()` 和 `flush()` 配合使用。

```php
// 浏览器在没有收到一定量的数据可能不给渲染
// echo str_repeat('--', 1024);
for ($i=0; $i < 10; $i++) {
	echo $i;
	//刷新ob输出缓存
	ob_flush();
	//刷新程序缓存
	flush();
	sleep(1);
}
```
